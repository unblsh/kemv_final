{% extends "base.html" %}

{% block content %}
<h1 class="mb-4">Strategic Dashboard</h1>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Crime Count by NIBRS Offense Category</div>
            <div class="card-body">
                <canvas id="offenseCategoryChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Total Crime Count Per Month (Past 12 Months)</div>
            <div class="card-body">
                <canvas id="monthlyCrimeChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Share of Group A vs B Offenses</div>
            <div class="card-body">
                <canvas id="nibrsGroupChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Crime Count Per Precinct</div>
            <div class="card-body">
                <canvas id="precinctCrimeChart"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">Top 5 Neighborhoods with Highest Crime</div>
            <div class="card-body">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Neighborhood</th>
                            <th>Crime Count</th>
                        </tr>
                    </thead>
                    <tbody id="topNeighborhoodsTableBody">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
     <div class="col-md-6">
        <div class="card">
            <div class="card-header">Crime Distribution by Neighborhood (Qualitative)</div>
            <div class="card-body">
                <canvas id="neighborhoodCrimeDistributionChart"></canvas>
                <small class="text-muted">This chart displays the crime count for all neighborhoods, providing a qualitative overview.</small>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/strategic-data')
            .then(response => response.json())
            .then(data => {
                // Bar Chart: Crime count by NIBRS Offense Category
                const offenseCategoryCtx = document.getElementById('offenseCategoryChart').getContext('2d');
                new Chart(offenseCategoryCtx, {
                    type: 'bar',
                    data: {
                        labels: data.offense_category_chart.labels,
                        datasets: [{
                            label: 'Crime Count',
                            data: data.offense_category_chart.values,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Line Chart: Total crime count per month over past 12 months
                const monthlyCrimeCtx = document.getElementById('monthlyCrimeChart').getContext('2d');
                new Chart(monthlyCrimeCtx, {
                    type: 'line',
                    data: {
                        labels: data.monthly_crime_chart.labels,
                        datasets: [{
                            label: 'Total Crime Count',
                            data: data.monthly_crime_chart.values,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Pie Chart: Share of Group A vs B offenses
                const nibrsGroupCtx = document.getElementById('nibrsGroupChart').getContext('2d');
                new Chart(nibrsGroupCtx, {
                    type: 'pie',
                    data: {
                        labels: data.nibrs_group_chart.labels,
                        datasets: [{
                            data: data.nibrs_group_chart.values,
                            backgroundColor: ['rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)', 'rgba(255, 206, 86, 0.6)']
                        }]
                    },
                    options: {
                        responsive: true,
                    }
                });

                // Vertical Bar: Crime count per precinct
                const precinctCrimeCtx = document.getElementById('precinctCrimeChart').getContext('2d');
                new Chart(precinctCrimeCtx, {
                    type: 'bar',
                    data: {
                        labels: data.precinct_crime_chart.labels,
                        datasets: [{
                            label: 'Crime Count',
                            data: data.precinct_crime_chart.values,
                            backgroundColor: 'rgba(153, 102, 255, 0.6)'
                        }]
                    },
                    options: {
                        indexAxis: 'y', // This makes it a horizontal bar chart, for vertical use 'x' or omit
                        responsive: true,
                        scales: {
                            x: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Table: Top 5 neighborhoods with highest crime
                const topNeighborhoodsTableBody = document.getElementById('topNeighborhoodsTableBody');
                data.top_neighborhoods.forEach(item => {
                    const row = topNeighborhoodsTableBody.insertRow();
                    const neighborhoodCell = row.insertCell();
                    const crimeCountCell = row.insertCell();
                    neighborhoodCell.textContent = item.neighborhood;
                    crimeCountCell.textContent = item.crime_count;
                });

                // Donut Chart: Distribution of offense categories (Same as offenseCategoryChart, just different type)
                const neighborhoodCrimeDistributionCtx = document.getElementById('neighborhoodCrimeDistributionChart').getContext('2d');
                const sortedNeighborhoods = data.all_neighborhood_crime_data.sort((a, b) => b.crime_count - a.crime_count);
                const neighborhoodLabels = sortedNeighborhoods.map(item => item.neighborhood);
                const neighborhoodValues = sortedNeighborhoods.map(item => item.crime_count);

                new Chart(neighborhoodCrimeDistributionCtx, {
                    type: 'bar',
                    data: {
                        labels: neighborhoodLabels,
                        datasets: [{
                            label: 'Crime Count',
                            data: neighborhoodValues,
                            backgroundColor: 'rgba(255, 159, 64, 0.6)'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        indexAxis: 'y',
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            })
            .catch(error => console.error('Error fetching strategic data:', error));
    });
</script>
{% endblock %} 